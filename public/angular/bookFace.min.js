(function(){angular.module("bookFaceApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,o){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/book/:bookid",{templateUrl:"/bookDetail/bookDetail.view.html",controller:"bookDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});o.html5Mode(true)}angular.module("bookFaceApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("bookFaceApp").controller("homeCtrl",e);e.$inject=["$scope","bookFaceData"];function e(e,o){var t=this;t.pageHeader={title:"bookFace",strapline:"Welcome to your favorite books!"};t.sidebar={content:"Looking for something to read? BookFace helps you find books to read easly!"};o.bookList().success(function(e){t.data={books:e};console.log(t.data)}).error(function(e){t.message="Sorry, something's gone wrong"});t.showError=function(o){e.$apply(function(){t.message=o.message})}}})();(function(){angular.module("bookFaceApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About bookFace"};e.main={content:"Enterprise-computing\nEnterprise computing, coursework 3 BookFace\n\nOverview\n\nThis coursework covers the development of an enterprise level application\n using a Javascript based framework (or similar technology). The coursework is designed to give students hands on experience with building enterprise applications. Furthermore, all the technologies used are production grade, giving students the experience and knowledge they need to build a real enterprise application. \n\nScenario\n\nYou have been asked to develop Bookface, a social networking site for people who love reading, and always have their face in a book. The site will allow avid readers to comment on their favourite books, rate books, and to read the comments made by others on their favourite books, and other books by their favourite authors. Users must register before they can submit comments on a book and be authorised via email. Users should choose a screen name and they should supply an email address. \n\nThe site should list authors together with their books. Comments are made on books, not on authors. Users can add authors if they are not already there, and they can add books to authors. Your program should list their favourite books of a user and be able to see other members of the site who listed those books as being among their favourite books.\n\nYou can use any JavaScript based stack to complete this task but it must use Node.js"}}})();(function(){angular.module("bookFaceApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.pageHeader={title:"Sign in to bookFace"};t.credentials={email:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doLogin()}};t.doLogin=function(){t.formError="";o.login(t.credentials).error(function(e){t.formError=e}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("bookFaceApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.pageHeader={title:"Create a new bookFace account"};t.credentials={name:"",email:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.name||!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doRegister()}};t.doRegister=function(){t.formError="";o.register(t.credentials).error(function(e){t.formError=e}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("bookFaceApp").controller("bookDetailCtrl",e);e.$inject=["$routeParams","$location","$modal","bookFaceData","authentication"];function e(e,o,t,r,n){var a=this;a.bookid=e.bookid;a.isLoggedIn=n.isLoggedIn();r.bookById(a.bookid).success(function(e){a.data={book:e};a.pageHeader={title:a.data.book.title}}).error(function(e){console.log(e)});a.popupReviewForm=function(){var e=t.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{bookData:function(){return{bookid:a.bookid,bookTitle:a.data.book.title}}}});e.result.then(function(e){a.data.book.reviews.push(e)})}}})();(function(){angular.module("bookFaceApp").controller("reviewModalCtrl",e);e.$inject=["$modalInstance","bookFaceData","bookData"];function e(e,o,t){var r=this;r.bookData=t;r.onSubmit=function(){r.formError="";if(!r.formData.rating||!r.formData.reviewText){r.formError="All fields required, please try again";return false}else{r.doAddReview(r.bookData.bookid,r.formData)}};r.doAddReview=function(e,t){o.addReviewById(e,{rating:t.rating,reviewText:t.reviewText}).success(function(e){r.modal.close(e)}).error(function(e){r.formError="Your review has not been saved, try again"});return false};r.modal={close:function(o){e.close(o)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("bookFaceApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,o){var t=function(e){o.localStorage["bookFace-token"]=e};var r=function(){return o.localStorage["bookFace-token"]};var n=function(){var e=r();if(e){var t=JSON.parse(o.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var a=function(){if(n()){var e=r();var t=JSON.parse(o.atob(e.split(".")[1]));return{email:t.email,name:t.name}}};register=function(o){return e.post("/api/register",o).success(function(e){t(e.token)})};login=function(o){return e.post("/api/login",o).success(function(e){t(e.token)})};logout=function(){o.localStorage.removeItem("bookFace-token")};return{currentUser:a,saveToken:t,getToken:r,isLoggedIn:n,register:register,login:login,logout:logout}}})();(function(){angular.module("bookFaceApp").service("bookFaceData",e);e.$inject=["$http","authentication"];function e(e,o){var t=function(){return e.get("/api/books")};var r=function(o){return e.get("/api/books/"+o)};var n=function(t,r){return e.post("/api/books/"+t+"/reviews",r,{headers:{Authorization:"Bearer "+o.getToken()}})};return{bookList:t,bookById:r,addReviewById:n}}})();(function(){angular.module("bookFaceApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var o=e.replace(/\n/g,"<br/>");return o}}})();(function(){angular.module("bookFaceApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();(function(){angular.module("bookFaceApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.currentPath=e.path();t.isLoggedIn=o.isLoggedIn();t.currentUser=o.currentUser();t.logout=function(){o.logout();e.path("#/")}}})();(function(){angular.module("bookFaceApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("bookFaceApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("bookFaceApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();